# Dealer Data Processor

Обработчик данных дилеров различных форматов.

Возможности: 
 - регистрация пользователй с подтверждением через электронную почту;
 - авторизация пользователей с различными ролями;
 - восстановление пароля;
 - управление пользователями через консоль;
 - обработка файлов формата xml, yaml, json и загрузка их в базу данных, следующим образом:
   - формат данных заводиться один раз;
   - возможны добавление или удаление полей, в случае если в выгрузке нет поля значит оно удаленно.

Используемые технологии:
 - PHP 7.4
 - Symfony 5.2
 - PHPUnit
 - RabbitMQ
 - Docker
 - Docker-compose
 - Git

Требования:
 - [x] соблюдение принципов SOLID
 - [x] использование паттерна Dependency Injection
 - [x] код должен соблюдать PSR-1, PSR-2
 - [x] документация Swagger
 - [x] бизнес логика должна быть выделена в специальный сервисный слой Clear Architecture
 - [x] в бизнес логике должен использоваться механизм наследования и обработки исключений
 - [x] должен использоваться паттерн Repository
 - [x] код должен быть задокументирован
 - [x] авторизация должна происходить через JWT 
 - [x] для разворачивание должен использоваться docker, docker-compose
 - [x] отправка писем должна быть асинхронной для этого требуется использовать RabbitMQ
 - [x] поддержка XDebug
 - [x] для отправки сообщений должен использоваться паттерн Observer

## Разворачивание проекта

1. Создать ключи для oauth2 в директории проекта docker/keys:

```bash
openssl genrsa -out private.key 2048 &&\
   openssl rsa -in private.key -pubout -out public.key

```

2. Запустить контейнеры:
```bash
$ docker-compose up --build -d
```

3. Выполнить установку зависимостей в контейнере php-fpm:
```bash
$ composer i
```

3. Создать базу данных:
```bash
$ ./bin/console doctrine:database:create
```

4. Выполнить миграции базы данных в контейнере php-fpm:
```bash
$ ./bin/console doctrine:migration:migrate
```

5. Выполнить обновление базы данных для работы компонента авторизации
```bash
$ ./bin/console doctrine:schema:update --force
```

6. Сгенерировать client_id и client_secret
```bash
$ ./bin/console trikoder:oauth2:create-client
```

7. Запустить обработчик события для отправки писем
```bash
$ ./bin/console rabbitmq:consumer
```

## Тестирование 

1. Развернуть окружение из раздела разворачивание проекта.

2. Создать структуры для тестовой базы данных, выполнить из контейнера php-fpm:
```bash
$ php bin/console doctrine:schema:create
```

3. Выполнить тесты 
```bash
$ php vendor/bin/phpUnit
```

# Документация 
 * [Документация API](/docs/README.md)
 * [Технический долг](/docs/technicalDept.md)
 * [Postman](/docs/Onbarding.postman_collection.json)
 * [Swagger](http://localhost:8081) для просмотра необходимо развернуть проект (создание отдельного файла занесено в тех. долг)
